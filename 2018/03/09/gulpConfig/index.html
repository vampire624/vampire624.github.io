<!DOCTYPE html>
<html>
  <!-- Html Head Tag-->
  <head>
  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="description" content="">
  <meta name="author" content="vampire624">
  <!-- Open Graph Data -->
  <meta property="og:title" content="一份“完善”的Gulp配置"/>
  <meta property="og:description" content="blog" />
  <meta property="og:site_name" content="zhonya&#39;s Hourglass"/>
  <meta property="og:type" content="article" />
  <meta property="og:image" content="http://vampire624.top"/>
  
    <link rel="alternate" href="/atom.xml" title="zhonya&#39;s Hourglass" type="application/atom+xml">
  
  
    <link rel="icon" href="/favicon.png">
  

  <!-- Site Title -->
  <title>zhonya's Hourglass</title>

  <!-- Bootstrap CSS -->
  <link rel="stylesheet" href="/css/bootstrap.min.css">
  <!-- Custom CSS -->
  
  <link rel="stylesheet" href="/css/style.light.css">

  <!-- Google Analytics -->
  
    <script>
        (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
                    (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
                m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
        })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

        ga('create', 'UA-106015191-1', 'auto');
        ga('send', 'pageview');
    </script>


</head>

  <body>
    <!-- Page Header -->


<header class="site-header header-background" style="background-image: url(/img/default-banner-dark.jpg)">
  <div class="container">
    <div class="row">
      <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
        <div class="page-title with-background-image">
          <p class="title">一份“完善”的Gulp配置</p>
          <p class="subtitle"></p>
        </div>
        <div class="site-menu with-background-image">
          <ul>
            
              <li>
                <a href="/">
                  
                  Home
                  
                </a>
              </li>
            
              <li>
                <a href="/archives">
                  
                  Archives
                  
                </a>
              </li>
            
              <li>
                <a href="https://github.com/vampire624">
                  
                  Github
                  
                </a>
              </li>
            
              <li>
                <a href="mailto:vampire_624@yeah.net">
                  
                  Email
                  
                </a>
              </li>
            
          </ul>
        </div>
      </div>
    </div>
  </div>
</header>


<article>
  <div class="container typo">
    <div class="row">
      <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
        <div class="post-info text-muted">
          
            <!-- Author -->
            <span class="author info">By vampire624</span>
          
          <!-- Date -->
          <span class="date-time info">On
            <span class="date">2018-03-09</span>
            <span class="time">11:22:17</span>
          </span>
          
          <!--  Categories  -->
            <span class="categories info">Under 

<a href="/categories/nodejs/">nodejs</a>
</span>
          
        </div>
        <!-- Tags -->
        
          <div class="post-tags text-muted">
            Tags: 

<a class="tag" href="/tags/nodejs/">#nodejs</a> <a class="tag" href="/tags/gulp/">#gulp</a>


          </div>
        
        <!-- Post Main Content -->
        <div class="post-content">
          <p>之前使用过gulp，一直只是作为编译sass，压缩css和合并压缩js来使用，没有对其进行详细的开发发布环境配置，这几天在着重使用，所以重新完善了下gulpfile.js文件，在rollup和parcel大热的势头下，我真的是使用gulp的一股清流了，嘻嘻。</p>
<a id="more"></a> 
<h1 id="完善配置gulpfile-js"><a href="#完善配置gulpfile-js" class="headerlink" title="完善配置gulpfile.js"></a>完善配置gulpfile.js</h1><h2 id="安装相关模块"><a href="#安装相关模块" class="headerlink" title="安装相关模块"></a>安装相关模块</h2><p>首先你需要安装有nodejs，nodejs自身带有安装包工具npm，如何安装？（本文使用linux，其他OS类似），安装非常方便，点击<a href="http://nodejs.cn" title="nodejs" target="_blank" rel="external">这里</a>，网上教程很多，这里不再赘述。<br>在工程目录下，打开命令行工具：</p>
<h4 id="第一步："><a href="#第一步：" class="headerlink" title="第一步："></a>第一步：</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">$ npm init</div></pre></td></tr></table></figure>
<p>之后一路回车，创建本地项目，主要是为了创建一份packeg.json文件，存放工程相关信息。</p>
<h4 id="第二步："><a href="#第二步：" class="headerlink" title="第二步："></a>第二步：</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">$ npm i gulp -g</div><div class="line">$ npm i gulp -D</div></pre></td></tr></table></figure>
<p>-D 代表 –save-dev ，保存该模块到packeg.json的开发依赖里，-S 代表 –save 保存该模块到packeg.json的生产依赖里。</p>
<h4 id="第三步："><a href="#第三步：" class="headerlink" title="第三步："></a>第三步：</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">$ npm i -D gulp-clean-css gulp-concat gulp-uglify gulp-sass gulp-clean gulp-babel babel-core babel-presets-env gulp-imagemin gulp-autoprefixer gulp-connect gulp-cache</div></pre></td></tr></table></figure>
<p>安装所有相关gulp插件，保存到packeg.json开发依赖。</p>
<h2 id="gulpfile-js"><a href="#gulpfile-js" class="headerlink" title="gulpfile.js"></a>gulpfile.js</h2><p>接下来，在项目工程根目录新建文件gulpfile.js，新建三个文件夹，分别是<code>/src</code>,<code>/build</code>和<code>/dist</code>,分别为开发目录，本地环境目录以及线上生产目录。<br>在gulpfile.js中引入gulp所有相关插件。<br>像这样：</p>
<pre><code>var gulp = require(&quot;gulp&quot;),
cleanCss = require(&quot;gulp-clean-css&quot;),
concat = require(&quot;gulp-concat&quot;),
uglify = require(&quot;gulp-uglify&quot;),
sass = require(&quot;gulp-sass&quot;),
clean = require(&quot;gulp-clean&quot;),
babel = require(&quot;gulp-babel&quot;),
imagemin = require(&quot;gulp-imagemin&quot;),
autoprefixer = require(&quot;gulp-autoprefixer&quot;),
connect = require(&quot;gulp-connect&quot;),
cache = require(&quot;gulp-cache&quot;);
</code></pre><h3 id="view任务"><a href="#view任务" class="headerlink" title="view任务"></a>view任务</h3><pre><code>gulp.task(&quot;view&quot;,function(){
return gulp.src(&quot;src/**/*.html&quot;)
    .pipe(gulp.dest(&quot;build/&quot;))
    .pipe(connect.reload())
    .pipe(gulp.dest(&quot;dist/&quot;))
})
</code></pre><p>创建gulp view任务，读取src下的所有.html文件，导入到build/下，拉取更新重载页面，之后再pipe到dist/。其中connect.reload()是热更新任务，稍后详细说明。    </p>
<h3 id="css任务"><a href="#css任务" class="headerlink" title="css任务"></a>css任务</h3><pre><code>gulp.task(&quot;css&quot;,function(){
return gulp.src(&quot;src/scss/**/*.html&quot;)
    .pipe(sass())
    .pipe(autoprefixer({
            browsers: [&quot;last 2 versions&quot;]
        }))
    .pipe(gulp.dest(&quot;build/css&quot;))
    .pipe(connect.reload())
    .pipe(cleanCss())
    .pipe(gulp.dest(&quot;dist/css&quot;))
})
</code></pre><p>创建gulp css任务，读取src/scss下的所有.scss文件，编译sass文件，增加css3前缀，导入到build/css下，拉取更新重载页面，之后再压缩css，pipe到dist/css。其中connect.reload()同样是热更新任务。</p>
<h3 id="js任务"><a href="#js任务" class="headerlink" title="js任务"></a>js任务</h3><pre><code>gulp.task(&quot;js&quot;,function(){
return gulp.src(&quot;src/js/**/*.html&quot;)
    .pipe(babel({
            presets: [&quot;env&quot;]
        }))
    .pipe(concat(&quot;all.js&quot;))
    .pipe(gulp.dest(&quot;build/js&quot;))
    .pipe(connect.reload())
    .pipe(uglify())
    .pipe(gulp.dest(&quot;dist/js&quot;))
})
</code></pre><p>创建gulp js任务，读取src/js下的所有.js文件，编译es6语法为es2015文件，拼接为一个js文件，导入到build/js下，拉取更新重载页面，之后再压缩js，pipe到dist/js。其中connect.reload()同样是热更新任务。</p>
<h3 id="image任务"><a href="#image任务" class="headerlink" title="image任务"></a>image任务</h3><pre><code>gulp.task(&quot;image&quot;,function(){
return gulp.src(&quot;src/image/*&quot;)
    .pipe(gulp.dest(&quot;build/image&quot;))
    .pipe(connect.reload())
    .pipe(cache(imagemin()))
    .pipe(gulp.dest(&quot;dist/image&quot;))
})
</code></pre><p>创建gulp css任务，读取src/image下的所有文件，导入到build/image下，拉取更新重载页面，之后再读取缓存压缩image，pipe到dist/css。其中connect.reload()同样是热更新任务。</p>
<h3 id="clean任务"><a href="#clean任务" class="headerlink" title="clean任务"></a>clean任务</h3><pre><code>gulp.task(&quot;clean&quot;,function(){
return gulp.src([&quot;build/*.+(js|css|html|png|jpeg|svg|)&quot;,&quot;dist/*.+(js|css|html|png|jpeg|svg|)&quot;], {read: false})
    .pipe(clean())
})
</code></pre><p>创建gulp clean任务，获取build/以及dist/下的所有文件，采用不读取的方式，直接删除所有文件。</p>
<h3 id="watch任务"><a href="#watch任务" class="headerlink" title="watch任务"></a>watch任务</h3><pre><code>gulp.task(&quot;watch&quot;,function(){
    gulp.watch(&quot;src/js/**/*.js&quot;,[&quot;js&quot;])
    gulp.watch(&quot;src/scss/**/*.scss&quot;,[&quot;css&quot;])
    gulp.watch(&quot;src/**/*.html&quot;,[&quot;view&quot;])
    gulp.watch(&quot;src/image/*&quot;,[&quot;iamge&quot;])
})
</code></pre><p>创建gulp watch任务，读取src/下的所有相关.js .scss .html 以及图片格式文件，进行监听，如有变动即刻执行相应任务。</p>
<h3 id="server任务"><a href="#server任务" class="headerlink" title="server任务"></a>server任务</h3><pre><code>gulp.task(&quot;server&quot;,function(){
    connect.server({
        root: &quot;build&quot;,
        livereload: true,
        port: 8080
    })
})
</code></pre><p>创建gulp server任务，启动热更新服务器，读取文件的根目录为build/，选择热更新为true，确定服务器端口为8080，再使用<code>.pipe(connect.reload())</code>,所有需要热更新的文件统一进行重载，就是前面view，css，js任务中的导入到build/后的相应操作，原因即是为实现浏览器的热更新。</p>
<h3 id="default任务"><a href="#default任务" class="headerlink" title="default任务"></a>default任务</h3><pre><code>gulp.task(&quot;default&quot;,[&quot;clean&quot;],function(){
    gulp.start(&quot;server&quot;,&quot;js&quot;,&quot;css&quot;,&quot;view&quot;,&quot;image&quot;,&quot;watch&quot;)
})
</code></pre><p>启动默认任务，异步执行clean任务，删除所有文件，之后开始依次执行<code>&quot;server&quot;,&quot;js&quot;,&quot;css&quot;,&quot;view&quot;,&quot;image&quot;,&quot;watch&quot;</code>任务。</p>
<h3 id="启动"><a href="#启动" class="headerlink" title="启动"></a>启动</h3><p>设置gulp启动时的默认任务，在命令行执行<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">$ gulp</div></pre></td></tr></table></figure></p>
<p>相当于执行<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">$ gulp default</div></pre></td></tr></table></figure></p>
<h2 id="写在最后："><a href="#写在最后：" class="headerlink" title="写在最后："></a>写在最后：</h2><p>gulp的stream式代码让所有任务看起来清晰易读，确实在当初grunt横行霸道引入前端工程化届的一股清流，但是越来越“懒”的人总想着不配置任何任务，让计算机尽可能处理多的事情。于是，2018，可能更多人回去拥抱parcel和rollup，拥抱明天。</p>

        </div>
      </div>
    </div>
  </div>
</article>



    <!-- Footer -->
<footer>
  <div class="container">
    <div class="row">
      <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
        <p class="copyright text-muted">
          Theme By <a target="_blank" href="https://github.com/levblanc">Levblanc.</a>
          Inspired By <a target="_blank" href="https://github.com/klugjo/hexo-theme-clean-blog">Clean Blog.</a>
        <p class="copyright text-muted">
          Powered By <a target="_blank" href="https://hexo.io/">Hexo.</a>
        </p>
      </div>
    </div>
  </div>
</footer>


    <!-- After Footer Scripts -->
<script src="/js/highlight.pack.js"></script>
<script>
  document.addEventListener("DOMContentLoaded", function(event) {
    var codeBlocks = Array.prototype.slice.call(document.getElementsByTagName('pre'))
    codeBlocks.forEach(function(block, index) {
      hljs.highlightBlock(block);
    });
  });
</script>

  </body>
</html>

